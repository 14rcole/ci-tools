package enhancement

import (
	"testing"

	jiraapi "github.com/andygrunwald/go-jira"
	"github.com/slack-go/slack"

	"github.com/openshift/ci-tools/pkg/jira"
	"github.com/openshift/ci-tools/pkg/slack/modals"
	"github.com/openshift/ci-tools/pkg/slack/modals/modaltesting"
)

func TestProcessSubmissionHandler(t *testing.T) {
	happyPath := modaltesting.SubmissionTestCase{
		Name:     "happy path with additional details",
		Callback: []byte(`{"type":"view_submission","token":"Rn1sVT099UjUeKclB3PkLT8t","callback_id":"","response_url":"","trigger_id":"1447326995184.1377252349923.75cfec20fd2f655085f20b540fb23448","action_ts":"","team":{"id":"T01B37EA9T5","name":"","domain":"dptp-robot-testing"},"channel":{"id":"","created":0,"is_open":false,"is_group":false,"is_shared":false,"is_im":false,"is_ext_shared":false,"is_org_shared":false,"is_pending_ext_shared":false,"is_private":false,"is_mpim":false,"unlinked":0,"name_normalized":"","num_members":0,"priority":0,"user":"","name":"","creator":"","is_archived":false,"members":null,"topic":{"value":"","creator":"","last_set":0},"purpose":{"value":"","creator":"","last_set":0},"is_channel":false,"is_general":false,"is_member":false,"locale":""},"user":{"id":"U01B31ARZDG","team_id":"T01B37EA9T5","name":"skuznets","deleted":false,"color":"","real_name":"","tz_label":"","tz_offset":0,"profile":{"first_name":"","last_name":"","real_name":"","real_name_normalized":"","display_name":"","display_name_normalized":"","email":"","skype":"","phone":"","image_24":"","image_32":"","image_48":"","image_72":"","image_192":"","image_original":"","title":"","status_expiration":0,"team":"","fields":[]},"is_bot":false,"is_admin":false,"is_owner":false,"is_primary_owner":false,"is_restricted":false,"is_ultra_restricted":false,"is_stranger":false,"is_app_user":false,"is_invited_user":false,"has_2fa":false,"has_files":false,"presence":"","locale":"","updated":0,"enterprise_user":{"id":"","enterprise_id":"","enterprise_name":"","is_admin":false,"is_owner":false,"teams":null}},"original_message":{"replace_original":false,"delete_original":false,"blocks":null},"message":{"replace_original":false,"delete_original":false,"blocks":null},"name":"","value":"","message_ts":"","attachment_id":"","actions":[],"view":{"ok":false,"error":"","id":"V01C8N3BWAJ","team_id":"T01B37EA9T5","type":"modal","title":{"type":"plain_text","text":"Request an Enhancement","emoji":true},"close":{"type":"plain_text","text":"Cancel","emoji":true},"submit":{"type":"plain_text","text":"Submit","emoji":true},"blocks":[{"type":"section","text":{"type":"plain_text","text":"The Test Platform team is committed to improving the developer productivity across the OpenShift organization. Use this form to request enhancements or new features to improve your development workflows.","emoji":true},"block_id":"9U/"},{"type":"divider","block_id":"9nCL"},{"type":"input","block_id":"title","label":{"type":"plain_text","text":"Provide a title for this enhancement:","emoji":true},"element":{"type":"plain_text_input","action_id":"XSf+"}},{"type":"section","text":{"type":"plain_text","text":"Provide a user story.","emoji":true},"block_id":"kUln"},{"type":"input","block_id":"as_a","label":{"type":"plain_text","text":"As a...","emoji":true},"element":{"type":"plain_text_input","action_id":"vq6zO"}},{"type":"input","block_id":"i_want","label":{"type":"plain_text","text":"I want...","emoji":true},"element":{"type":"plain_text_input","action_id":"jLZ"}},{"type":"input","block_id":"so_that","label":{"type":"plain_text","text":"So that...","emoji":true},"element":{"type":"plain_text_input","action_id":"0PktF"}},{"type":"input","block_id":"summary","label":{"type":"plain_text","text":"Provide context on why this is a need and any specifics on the requirement:","emoji":true},"element":{"type":"plain_text_input","action_id":"nNIA/","multiline":true}},{"type":"input","block_id":"impact","label":{"type":"plain_text","text":"Explain how many developers would be impacted by this enhancement and to what extent their workflows would be improved:","emoji":true},"element":{"type":"plain_text_input","action_id":"ts1Y","multiline":true}},{"type":"input","block_id":"acceptance_criteria","label":{"type":"plain_text","text":"Provide acceptance criteria (one per line) for this feature, focusing on what is to be achieved, not how:","emoji":true},"element":{"type":"plain_text_input","action_id":"7NY0","multiline":true}},{"type":"input","block_id":"implementation","label":{"type":"plain_text","text":"Provide any implementation notes:","emoji":true},"element":{"type":"plain_text_input","action_id":"962bw","multiline":true},"optional":true}],"private_metadata":"enhancement","callback_id":"","state":{"values":{"acceptance_criteria":{"7NY0":{"action_id":"","block_id":"","type":"plain_text_input","text":{"type":"","text":""},"value":"I can fly\nNobody else can fly","action_ts":"","selected_option":{"text":null,"value":""},"selected_options":null,"selected_user":"","selected_users":null,"selected_channel":"","selected_channels":null,"selected_conversation":"","selected_conversations":null,"selected_date":"","initial_option":{"text":null,"value":""},"initial_user":"","initial_channel":"","initial_conversation":"","initial_date":""}},"as_a":{"vq6zO":{"action_id":"","block_id":"","type":"plain_text_input","text":{"type":"","text":""},"value":"person","action_ts":"","selected_option":{"text":null,"value":""},"selected_options":null,"selected_user":"","selected_users":null,"selected_channel":"","selected_channels":null,"selected_conversation":"","selected_conversations":null,"selected_date":"","initial_option":{"text":null,"value":""},"initial_user":"","initial_channel":"","initial_conversation":"","initial_date":""}},"i_want":{"jLZ":{"action_id":"","block_id":"","type":"plain_text_input","text":{"type":"","text":""},"value":"to fly","action_ts":"","selected_option":{"text":null,"value":""},"selected_options":null,"selected_user":"","selected_users":null,"selected_channel":"","selected_channels":null,"selected_conversation":"","selected_conversations":null,"selected_date":"","initial_option":{"text":null,"value":""},"initial_user":"","initial_channel":"","initial_conversation":"","initial_date":""}},"impact":{"ts1Y":{"action_id":"","block_id":"","type":"plain_text_input","text":{"type":"","text":""},"value":"Only I benefit.","action_ts":"","selected_option":{"text":null,"value":""},"selected_options":null,"selected_user":"","selected_users":null,"selected_channel":"","selected_channels":null,"selected_conversation":"","selected_conversations":null,"selected_date":"","initial_option":{"text":null,"value":""},"initial_user":"","initial_channel":"","initial_conversation":"","initial_date":""}},"implementation":{"962bw":{"action_id":"","block_id":"","type":"plain_text_input","text":{"type":"","text":""},"value":"It needs to be done quickly.","action_ts":"","selected_option":{"text":null,"value":""},"selected_options":null,"selected_user":"","selected_users":null,"selected_channel":"","selected_channels":null,"selected_conversation":"","selected_conversations":null,"selected_date":"","initial_option":{"text":null,"value":""},"initial_user":"","initial_channel":"","initial_conversation":"","initial_date":""}},"so_that":{"0PktF":{"action_id":"","block_id":"","type":"plain_text_input","text":{"type":"","text":""},"value":"I can be cool","action_ts":"","selected_option":{"text":null,"value":""},"selected_options":null,"selected_user":"","selected_users":null,"selected_channel":"","selected_channels":null,"selected_conversation":"","selected_conversations":null,"selected_date":"","initial_option":{"text":null,"value":""},"initial_user":"","initial_channel":"","initial_conversation":"","initial_date":""}},"summary":{"nNIA/":{"action_id":"","block_id":"","type":"plain_text_input","text":{"type":"","text":""},"value":"This is really important for me.","action_ts":"","selected_option":{"text":null,"value":""},"selected_options":null,"selected_user":"","selected_users":null,"selected_channel":"","selected_channels":null,"selected_conversation":"","selected_conversations":null,"selected_date":"","initial_option":{"text":null,"value":""},"initial_user":"","initial_channel":"","initial_conversation":"","initial_date":""}},"title":{"XSf+":{"action_id":"","block_id":"","type":"plain_text_input","text":{"type":"","text":""},"value":"I Need Something","action_ts":"","selected_option":{"text":null,"value":""},"selected_options":null,"selected_user":"","selected_users":null,"selected_channel":"","selected_channels":null,"selected_conversation":"","selected_conversations":null,"selected_date":"","initial_option":{"text":null,"value":""},"initial_user":"","initial_channel":"","initial_conversation":"","initial_date":""}}}},"hash":"1602538163.qm2wjmgG","clear_on_close":false,"notify_on_close":false,"root_view_id":"V01C8N3BWAJ","previous_view_id":"","app_id":"A01BJF00CAD","external_id":"","bot_id":"B01B63T6ZFD"},"action_id":"","api_app_id":"A01BJF00CAD","block_id":"","container":{"type":"","view_id":"","message_ts":"","attachment_id":0,"channel_id":"","is_ephemeral":false,"is_app_unfurl":false},"submission":null,"hash":"","is_cleared":false}`),
		Filer: jira.NewFake(map[jira.IssueRequest]jira.IssueResponse{
			{
				IssueType: "Story",
				Title:     "I Need Something",
				Description: `h3. Overview
As a person
I want to fly
So that I can be cool

h3. Summary
This is really important for me.

h3. Impact
Only I benefit.

h3. Acceptance Criteria
* I can fly
* Nobody else can fly

h3. Implementation Details
It needs to be done quickly.`,
				Reporter: "U01B31ARZDG",
			}: {
				Issue: &jiraapi.Issue{Key: "WHOA-123"},
				Error: nil,
			},
		}),
		Updater: modals.NewFake([]modals.ViewUpdate{
			{
				ViewUpdateRequest: modals.ViewUpdateRequest{
					View:       modals.JiraView("WHOA-123"),
					ExternalID: "",
					Hash:       "", // updated unconditionally, should be empty
					ViewID:     "V01C8N3BWAJ",
				},
				ViewUpdateResponse: modals.ViewUpdateResponse{
					Response: &slack.ViewResponse{},
					Error:    nil,
				},
			},
		}),
		ExpectedPayload: []byte(`{"response_action":"update","view":{"type":"modal","title":{"type":"plain_text","text":"Creating Jira Issue..."},"blocks":[{"type":"section","text":{"type":"mrkdwn","text":"A Jira issue is being filed, please do not close this window..."}}],"private_metadata":"jira_pending"}}`),
		ExpectedError:   false,
	}
	modaltesting.ValidateSubmission(t, processSubmissionHandler(happyPath.Filer, happyPath.Updater), happyPath)
}

func TestIssueParameters(t *testing.T) {
	parameters := issueParameters()
	modaltesting.ValidateBlockIds(t, View(), parameters.Fields...)
	modaltesting.ValidateParameterProcessing(t, parameters, []modaltesting.ProcessTestCase{
		{
			Name:          "one acceptance criteria, no additional details",
			Callback:      []byte(`{"type":"view_submission","token":"Rn1sVT099UjUeKclB3PkLT8t","callback_id":"","response_url":"","trigger_id":"1447377632496.1377252349923.bfff0e6543e096992298d57d6db53381","action_ts":"","team":{"id":"T01B37EA9T5","name":"","domain":"dptp-robot-testing"},"channel":{"id":"","created":0,"is_open":false,"is_group":false,"is_shared":false,"is_im":false,"is_ext_shared":false,"is_org_shared":false,"is_pending_ext_shared":false,"is_private":false,"is_mpim":false,"unlinked":0,"name_normalized":"","num_members":0,"priority":0,"user":"","name":"","creator":"","is_archived":false,"members":null,"topic":{"value":"","creator":"","last_set":0},"purpose":{"value":"","creator":"","last_set":0},"is_channel":false,"is_general":false,"is_member":false,"locale":""},"user":{"id":"U01B31ARZDG","team_id":"T01B37EA9T5","name":"skuznets","deleted":false,"color":"","real_name":"","tz_label":"","tz_offset":0,"profile":{"first_name":"","last_name":"","real_name":"","real_name_normalized":"","display_name":"","display_name_normalized":"","email":"","skype":"","phone":"","image_24":"","image_32":"","image_48":"","image_72":"","image_192":"","image_original":"","title":"","status_expiration":0,"team":"","fields":[]},"is_bot":false,"is_admin":false,"is_owner":false,"is_primary_owner":false,"is_restricted":false,"is_ultra_restricted":false,"is_stranger":false,"is_app_user":false,"is_invited_user":false,"has_2fa":false,"has_files":false,"presence":"","locale":"","updated":0,"enterprise_user":{"id":"","enterprise_id":"","enterprise_name":"","is_admin":false,"is_owner":false,"teams":null}},"original_message":{"replace_original":false,"delete_original":false,"blocks":null},"message":{"replace_original":false,"delete_original":false,"blocks":null},"name":"","value":"","message_ts":"","attachment_id":"","actions":[],"view":{"ok":false,"error":"","id":"V01CU4SRQC9","team_id":"T01B37EA9T5","type":"modal","title":{"type":"plain_text","text":"Request an Enhancement","emoji":true},"close":{"type":"plain_text","text":"Cancel","emoji":true},"submit":{"type":"plain_text","text":"Submit","emoji":true},"blocks":[{"type":"section","text":{"type":"plain_text","text":"The Test Platform team is committed to improving the developer productivity across the OpenShift organization. Use this form to request enhancements or new features to improve your development workflows.","emoji":true},"block_id":"q1kSS"},{"type":"divider","block_id":"GIA2M"},{"type":"input","block_id":"title","label":{"type":"plain_text","text":"Provide a title for this enhancement:","emoji":true},"element":{"type":"plain_text_input","action_id":"lXN8"}},{"type":"section","text":{"type":"plain_text","text":"Provide a user story.","emoji":true},"block_id":"fHvy"},{"type":"input","block_id":"as_a","label":{"type":"plain_text","text":"As a...","emoji":true},"element":{"type":"plain_text_input","action_id":"NNzU3"}},{"type":"input","block_id":"i_want","label":{"type":"plain_text","text":"I want...","emoji":true},"element":{"type":"plain_text_input","action_id":"Q8u"}},{"type":"input","block_id":"so_that","label":{"type":"plain_text","text":"So that...","emoji":true},"element":{"type":"plain_text_input","action_id":"=sgx"}},{"type":"input","block_id":"summary","label":{"type":"plain_text","text":"Provide context on why this is a need and any specifics on the requirement:","emoji":true},"element":{"type":"plain_text_input","action_id":"8gte","multiline":true}},{"type":"input","block_id":"impact","label":{"type":"plain_text","text":"Explain how many developers would be impacted by this enhancement and to what extent their workflows would be improved:","emoji":true},"element":{"type":"plain_text_input","action_id":"Ggvjt","multiline":true}},{"type":"input","block_id":"acceptance_criteria","label":{"type":"plain_text","text":"Provide acceptance criteria (one per line) for this feature, focusing on what is to be achieved, not how:","emoji":true},"element":{"type":"plain_text_input","action_id":"0cH","multiline":true}},{"type":"input","block_id":"implementation","label":{"type":"plain_text","text":"Provide any implementation notes:","emoji":true},"element":{"type":"plain_text_input","action_id":"CQ7n","multiline":true},"optional":true}],"private_metadata":"enhancement","callback_id":"","state":{"values":{"acceptance_criteria":{"0cH":{"action_id":"","block_id":"","type":"plain_text_input","text":{"type":"","text":""},"value":"I play ten hours of World Of Warcraft and do no work every day","action_ts":"","selected_option":{"text":null,"value":""},"selected_options":null,"selected_user":"","selected_users":null,"selected_channel":"","selected_channels":null,"selected_conversation":"","selected_conversations":null,"selected_date":"","initial_option":{"text":null,"value":""},"initial_user":"","initial_channel":"","initial_conversation":"","initial_date":""}},"as_a":{"NNzU3":{"action_id":"","block_id":"","type":"plain_text_input","text":{"type":"","text":""},"value":"developer","action_ts":"","selected_option":{"text":null,"value":""},"selected_options":null,"selected_user":"","selected_users":null,"selected_channel":"","selected_channels":null,"selected_conversation":"","selected_conversations":null,"selected_date":"","initial_option":{"text":null,"value":""},"initial_user":"","initial_channel":"","initial_conversation":"","initial_date":""}},"i_want":{"Q8u":{"action_id":"","block_id":"","type":"plain_text_input","text":{"type":"","text":""},"value":"to have my code autogenerated","action_ts":"","selected_option":{"text":null,"value":""},"selected_options":null,"selected_user":"","selected_users":null,"selected_channel":"","selected_channels":null,"selected_conversation":"","selected_conversations":null,"selected_date":"","initial_option":{"text":null,"value":""},"initial_user":"","initial_channel":"","initial_conversation":"","initial_date":""}},"impact":{"Ggvjt":{"action_id":"","block_id":"","type":"plain_text_input","text":{"type":"","text":""},"value":"Every developer can benefit.","action_ts":"","selected_option":{"text":null,"value":""},"selected_options":null,"selected_user":"","selected_users":null,"selected_channel":"","selected_channels":null,"selected_conversation":"","selected_conversations":null,"selected_date":"","initial_option":{"text":null,"value":""},"initial_user":"","initial_channel":"","initial_conversation":"","initial_date":""}},"implementation":{"CQ7n":{"action_id":"","block_id":"","type":"plain_text_input","text":{"type":"","text":""},"value":"","action_ts":"","selected_option":{"text":null,"value":""},"selected_options":null,"selected_user":"","selected_users":null,"selected_channel":"","selected_channels":null,"selected_conversation":"","selected_conversations":null,"selected_date":"","initial_option":{"text":null,"value":""},"initial_user":"","initial_channel":"","initial_conversation":"","initial_date":""}},"so_that":{"=sgx":{"action_id":"","block_id":"","type":"plain_text_input","text":{"type":"","text":""},"value":"I can play World of Warcraft","action_ts":"","selected_option":{"text":null,"value":""},"selected_options":null,"selected_user":"","selected_users":null,"selected_channel":"","selected_channels":null,"selected_conversation":"","selected_conversations":null,"selected_date":"","initial_option":{"text":null,"value":""},"initial_user":"","initial_channel":"","initial_conversation":"","initial_date":""}},"summary":{"8gte":{"action_id":"","block_id":"","type":"plain_text_input","text":{"type":"","text":""},"value":"This will be a breakthrough for the company.","action_ts":"","selected_option":{"text":null,"value":""},"selected_options":null,"selected_user":"","selected_users":null,"selected_channel":"","selected_channels":null,"selected_conversation":"","selected_conversations":null,"selected_date":"","initial_option":{"text":null,"value":""},"initial_user":"","initial_channel":"","initial_conversation":"","initial_date":""}},"title":{"lXN8":{"action_id":"","block_id":"","type":"plain_text_input","text":{"type":"","text":""},"value":"New Feature","action_ts":"","selected_option":{"text":null,"value":""},"selected_options":null,"selected_user":"","selected_users":null,"selected_channel":"","selected_channels":null,"selected_conversation":"","selected_conversations":null,"selected_date":"","initial_option":{"text":null,"value":""},"initial_user":"","initial_channel":"","initial_conversation":"","initial_date":""}}}},"hash":"1602540046.M3jo4s6g","clear_on_close":false,"notify_on_close":false,"root_view_id":"V01CU4SRQC9","previous_view_id":"","app_id":"A01BJF00CAD","external_id":"","bot_id":"B01B63T6ZFD"},"action_id":"","api_app_id":"A01BJF00CAD","block_id":"","container":{"type":"","view_id":"","message_ts":"","attachment_id":0,"channel_id":"","is_ephemeral":false,"is_app_unfurl":false},"submission":null,"hash":"","is_cleared":false}`),
			ExpectedTitle: "New Feature",
			ExpectedBody: `h3. Overview
As a developer
I want to have my code autogenerated
So that I can play World of Warcraft

h3. Summary
This will be a breakthrough for the company.

h3. Impact
Every developer can benefit.

h3. Acceptance Criteria
* I play ten hours of World Of Warcraft and do no work every day`,
		},
		{
			Name:          "many acceptance criteria, additional details",
			Callback:      []byte(`{"type":"view_submission","token":"Rn1sVT099UjUeKclB3PkLT8t","callback_id":"","response_url":"","trigger_id":"1447326995184.1377252349923.75cfec20fd2f655085f20b540fb23448","action_ts":"","team":{"id":"T01B37EA9T5","name":"","domain":"dptp-robot-testing"},"channel":{"id":"","created":0,"is_open":false,"is_group":false,"is_shared":false,"is_im":false,"is_ext_shared":false,"is_org_shared":false,"is_pending_ext_shared":false,"is_private":false,"is_mpim":false,"unlinked":0,"name_normalized":"","num_members":0,"priority":0,"user":"","name":"","creator":"","is_archived":false,"members":null,"topic":{"value":"","creator":"","last_set":0},"purpose":{"value":"","creator":"","last_set":0},"is_channel":false,"is_general":false,"is_member":false,"locale":""},"user":{"id":"U01B31ARZDG","team_id":"T01B37EA9T5","name":"skuznets","deleted":false,"color":"","real_name":"","tz_label":"","tz_offset":0,"profile":{"first_name":"","last_name":"","real_name":"","real_name_normalized":"","display_name":"","display_name_normalized":"","email":"","skype":"","phone":"","image_24":"","image_32":"","image_48":"","image_72":"","image_192":"","image_original":"","title":"","status_expiration":0,"team":"","fields":[]},"is_bot":false,"is_admin":false,"is_owner":false,"is_primary_owner":false,"is_restricted":false,"is_ultra_restricted":false,"is_stranger":false,"is_app_user":false,"is_invited_user":false,"has_2fa":false,"has_files":false,"presence":"","locale":"","updated":0,"enterprise_user":{"id":"","enterprise_id":"","enterprise_name":"","is_admin":false,"is_owner":false,"teams":null}},"original_message":{"replace_original":false,"delete_original":false,"blocks":null},"message":{"replace_original":false,"delete_original":false,"blocks":null},"name":"","value":"","message_ts":"","attachment_id":"","actions":[],"view":{"ok":false,"error":"","id":"V01C8N3BWAJ","team_id":"T01B37EA9T5","type":"modal","title":{"type":"plain_text","text":"Request an Enhancement","emoji":true},"close":{"type":"plain_text","text":"Cancel","emoji":true},"submit":{"type":"plain_text","text":"Submit","emoji":true},"blocks":[{"type":"section","text":{"type":"plain_text","text":"The Test Platform team is committed to improving the developer productivity across the OpenShift organization. Use this form to request enhancements or new features to improve your development workflows.","emoji":true},"block_id":"9U/"},{"type":"divider","block_id":"9nCL"},{"type":"input","block_id":"title","label":{"type":"plain_text","text":"Provide a title for this enhancement:","emoji":true},"element":{"type":"plain_text_input","action_id":"XSf+"}},{"type":"section","text":{"type":"plain_text","text":"Provide a user story.","emoji":true},"block_id":"kUln"},{"type":"input","block_id":"as_a","label":{"type":"plain_text","text":"As a...","emoji":true},"element":{"type":"plain_text_input","action_id":"vq6zO"}},{"type":"input","block_id":"i_want","label":{"type":"plain_text","text":"I want...","emoji":true},"element":{"type":"plain_text_input","action_id":"jLZ"}},{"type":"input","block_id":"so_that","label":{"type":"plain_text","text":"So that...","emoji":true},"element":{"type":"plain_text_input","action_id":"0PktF"}},{"type":"input","block_id":"summary","label":{"type":"plain_text","text":"Provide context on why this is a need and any specifics on the requirement:","emoji":true},"element":{"type":"plain_text_input","action_id":"nNIA/","multiline":true}},{"type":"input","block_id":"impact","label":{"type":"plain_text","text":"Explain how many developers would be impacted by this enhancement and to what extent their workflows would be improved:","emoji":true},"element":{"type":"plain_text_input","action_id":"ts1Y","multiline":true}},{"type":"input","block_id":"acceptance_criteria","label":{"type":"plain_text","text":"Provide acceptance criteria (one per line) for this feature, focusing on what is to be achieved, not how:","emoji":true},"element":{"type":"plain_text_input","action_id":"7NY0","multiline":true}},{"type":"input","block_id":"implementation","label":{"type":"plain_text","text":"Provide any implementation notes:","emoji":true},"element":{"type":"plain_text_input","action_id":"962bw","multiline":true},"optional":true}],"private_metadata":"enhancement","callback_id":"","state":{"values":{"acceptance_criteria":{"7NY0":{"action_id":"","block_id":"","type":"plain_text_input","text":{"type":"","text":""},"value":"I can fly\nNobody else can fly","action_ts":"","selected_option":{"text":null,"value":""},"selected_options":null,"selected_user":"","selected_users":null,"selected_channel":"","selected_channels":null,"selected_conversation":"","selected_conversations":null,"selected_date":"","initial_option":{"text":null,"value":""},"initial_user":"","initial_channel":"","initial_conversation":"","initial_date":""}},"as_a":{"vq6zO":{"action_id":"","block_id":"","type":"plain_text_input","text":{"type":"","text":""},"value":"person","action_ts":"","selected_option":{"text":null,"value":""},"selected_options":null,"selected_user":"","selected_users":null,"selected_channel":"","selected_channels":null,"selected_conversation":"","selected_conversations":null,"selected_date":"","initial_option":{"text":null,"value":""},"initial_user":"","initial_channel":"","initial_conversation":"","initial_date":""}},"i_want":{"jLZ":{"action_id":"","block_id":"","type":"plain_text_input","text":{"type":"","text":""},"value":"to fly","action_ts":"","selected_option":{"text":null,"value":""},"selected_options":null,"selected_user":"","selected_users":null,"selected_channel":"","selected_channels":null,"selected_conversation":"","selected_conversations":null,"selected_date":"","initial_option":{"text":null,"value":""},"initial_user":"","initial_channel":"","initial_conversation":"","initial_date":""}},"impact":{"ts1Y":{"action_id":"","block_id":"","type":"plain_text_input","text":{"type":"","text":""},"value":"Only I benefit.","action_ts":"","selected_option":{"text":null,"value":""},"selected_options":null,"selected_user":"","selected_users":null,"selected_channel":"","selected_channels":null,"selected_conversation":"","selected_conversations":null,"selected_date":"","initial_option":{"text":null,"value":""},"initial_user":"","initial_channel":"","initial_conversation":"","initial_date":""}},"implementation":{"962bw":{"action_id":"","block_id":"","type":"plain_text_input","text":{"type":"","text":""},"value":"It needs to be done quickly.","action_ts":"","selected_option":{"text":null,"value":""},"selected_options":null,"selected_user":"","selected_users":null,"selected_channel":"","selected_channels":null,"selected_conversation":"","selected_conversations":null,"selected_date":"","initial_option":{"text":null,"value":""},"initial_user":"","initial_channel":"","initial_conversation":"","initial_date":""}},"so_that":{"0PktF":{"action_id":"","block_id":"","type":"plain_text_input","text":{"type":"","text":""},"value":"I can be cool","action_ts":"","selected_option":{"text":null,"value":""},"selected_options":null,"selected_user":"","selected_users":null,"selected_channel":"","selected_channels":null,"selected_conversation":"","selected_conversations":null,"selected_date":"","initial_option":{"text":null,"value":""},"initial_user":"","initial_channel":"","initial_conversation":"","initial_date":""}},"summary":{"nNIA/":{"action_id":"","block_id":"","type":"plain_text_input","text":{"type":"","text":""},"value":"This is really important for me.","action_ts":"","selected_option":{"text":null,"value":""},"selected_options":null,"selected_user":"","selected_users":null,"selected_channel":"","selected_channels":null,"selected_conversation":"","selected_conversations":null,"selected_date":"","initial_option":{"text":null,"value":""},"initial_user":"","initial_channel":"","initial_conversation":"","initial_date":""}},"title":{"XSf+":{"action_id":"","block_id":"","type":"plain_text_input","text":{"type":"","text":""},"value":"I Need Something","action_ts":"","selected_option":{"text":null,"value":""},"selected_options":null,"selected_user":"","selected_users":null,"selected_channel":"","selected_channels":null,"selected_conversation":"","selected_conversations":null,"selected_date":"","initial_option":{"text":null,"value":""},"initial_user":"","initial_channel":"","initial_conversation":"","initial_date":""}}}},"hash":"1602538163.qm2wjmgG","clear_on_close":false,"notify_on_close":false,"root_view_id":"V01C8N3BWAJ","previous_view_id":"","app_id":"A01BJF00CAD","external_id":"","bot_id":"B01B63T6ZFD"},"action_id":"","api_app_id":"A01BJF00CAD","block_id":"","container":{"type":"","view_id":"","message_ts":"","attachment_id":0,"channel_id":"","is_ephemeral":false,"is_app_unfurl":false},"submission":null,"hash":"","is_cleared":false}`),
			ExpectedTitle: "I Need Something",
			ExpectedBody: `h3. Overview
As a person
I want to fly
So that I can be cool

h3. Summary
This is really important for me.

h3. Impact
Only I benefit.

h3. Acceptance Criteria
* I can fly
* Nobody else can fly

h3. Implementation Details
It needs to be done quickly.`,
		},
	})
}
